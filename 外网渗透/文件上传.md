- 漏洞成因 ：
  没有对上传文件的类型、后缀进行检测，造成攻击者可以成功上传恶意脚本，达到获取服务器信息，甚至执行命令的目的。

- 绕过方式

  - 1.文件后缀前端JS绕过
    客户端代码检测了文件后缀，通过直接修改客户端的JS代码，成功上传脚本文件。或者上传正常的文件，然后在burp抓包，对文件后缀进行修改。

  - 2.后端文件类型检测绕过
    通过修改content-type，如果通过一些函数限制只能上传图片，那么可以合成图片马进行上传

  - 3.利用Apache解析漏洞绕过

    Apache是从右到左解析的，比如a.php.xxx,xxx不能解析，但是php可以解析，脚本文件被成功解析。

    - 前提：在conf文件里有AddHandler php5-script .php或者AddType application/x-httpd-php .jpg

  - 4.%00截断绕过（是Ngnix<8.0)
    %00代表中止，比如a.php%001.jpg，能不能成功，需要看后端代码的逻辑，如果后端代码取其值作为文件名则可以成功解析脚本。

  - 5.条件竞争绕过
    后端对上传前的文件类型没有做校验，对成功上传的文件校验之后进行删除，利用上传和删除的时间差，在脚本文件中写入引用另一个脚本文件，成功将另一个脚本文件上传。

  - 6.基于内容的检测绕过方式
    先写一句话木马，把后缀改为.jpg，如果上传被拦截，说明基于文件内容进行检测，发送正常文件，打开Burp抓包，末尾添加一句话木马，并把文件后缀改为.php

  - 7.IIS 6.0解析缺陷

    filepath=upload/1.asp/;filename=xx.jpg
    filepath=upload/1.php:xx.php;filename=xx.jpg

    - a.php:1.jpg

  - 8.IIS 7.5解析缺陷
    - 1.jpg/shell.php

- 防御方式

  - 采用白名单

  - 对上传的文件进行重命名

  - 对上传的目录设定为不可执行权限